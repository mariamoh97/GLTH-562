"0","poly_url <- ""https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/geospatial/world_polygons_simplified.json"""
"0","line_url <- ""https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/geospatial/world_lines_simplified.json"""
"0",""
"0","# Add CRS to poly and join values from csv"
"0","poly_refugees <- read_sf(poly_url) |> "
"0","  st_set_crs(4326) |> "
"0","  left_join(country_data, by = c(""color_code"" = ""coo_iso"")) |> "
"0","  mutate(legend = case_when("
"0","    total_refugees < 1e4 ~ ""<10k"","
"0","    total_refugees < 1e5 ~ ""10k-100k"","
"0","    total_refugees < 1e6 ~ ""100k-1M"","
"0","    is.na(total_refugees) ~ NA_character_,"
"0","    TRUE ~ "">1M"""
"0","  )) |> "
"0","  mutate(legend = as_factor(legend) |> "
"0","           fct_relevel(""<10k"", ""10k-100k"", ""100k-1M"", "">1M""))"
"0",""
"0","poly_idps <- read_sf(poly_url) |> "
"0","  st_set_crs(4326) |> "
"0","  left_join(country_data, by = c(""color_code"" = ""coo_iso"")) |> "
"0","  mutate(legend = case_when("
"0","    total_idps < 1e4 ~ ""<10k"","
"0","    total_idps < 1e5 ~ ""10k-100k"","
"0","    total_idps < 1e6 ~ ""100k-1M"","
"0","    is.na(total_idps) ~ NA_character_,"
"0","    TRUE ~ "">1M"""
"0","  )) |> "
"0","  mutate(legend = as_factor(legend) |> "
"0","           fct_relevel(""<10k"", ""10k-100k"", ""100k-1M"", "">1M""))"
"2","Warning: [38;5;232mThere was 1 warning in `stopifnot()`.[39m
[38;5;232m[36mâ„¹[38;5;232m In argument: `legend = fct_relevel(...)`.[39m
Caused by warning:
[33m![39m [38;5;232m1 unknown level in `f`: 10k-100k[39m"
"0","  "
"0",""
"0","# Sort line type"
"0","line <- read_sf(line_url) |>"
"0","  mutate("
"0","    type = as_factor(type) |>"
"0","      fct_relevel(""solid"", ""dashed"", ""dotted"", ""dashed-dot"")"
"0","  ) |> "
"0","  st_set_crs(4326)"
"0",""
"0","# # Data URL"
"0","# df_url <- read_csv(""https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/geospatial/bubble_map.csv"")"
"0","# "
"0","# country_data <- refugees::population %>%"
"0","#                 filter(year >= 2012 & year <= 2022) %>%"
"0","#                 group_by(coo_name, coo_iso) %>%"
"0","#                 summarise(total_refugees = sum(refugees),"
"0","#                           total_asylum = sum(asylum_seekers),"
"0","#                           total_idps = sum(idps)) %>%"
"0","#                 ungroup()"
"0","# # country_data"
"0","# loc_data <- country_data %>%"
"0","#             left_join(df_url, c(""coo_iso"" = ""iso3"")) %>%"
"0","#             select(-gis_name, -ref)"
"0","# "
"0","# top10_refugees <- loc_data %>%"
"0","#                   arrange(desc(total_refugees)) %>%"
"0","#                   drop_na(lon)"
"0","# # print(head(top10_refugees, 10))"
"0","# "
"0","# top10_asylum <- loc_data %>% "
"0","#                 arrange(desc(total_asylum)) %>%"
"0","#                 drop_na(lon)"
"0","# # print(head(top10_asylum, 10))"
"0","# "
"0","# top10_idps <- loc_data %>%"
"0","#               arrange(desc(total_idps)) %>%"
"0","#               drop_na(lon)"
"0","# # print(head(top10_idps, 10))"
"0","#             "
"0","# "
"0","# poly_url <- ""https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/geospatial/world_polygons_simplified.json"""
"0","# line_url <- ""https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/geospatial/world_lines_simplified.json"""
"0","# "
"0","# # Read and transform data for refugees"
"0","# df_ref <- top10_refugees %>% "
"0","#   st_as_sf(coords = c(""lon"", ""lat""),"
"0","#            crs = 4326)"
"0","# "
"0","# poly <- read_sf(poly_url) %>%"
"0","#   st_set_crs(4326)"
"0","# "
"0","# line <- read_sf(line_url) %>%"
"0","#   mutate("
"0","#     type = as_factor(type) %>%"
"0","#       fct_relevel(""solid"", ""dashed"", ""dotted"", ""dashed-dot"")"
"0","#   ) %>%"
"0","#   st_set_crs(4326)"
"0","# "
"0","# # Read and transform data for asylum seekers"
"0","# df_asy <- top10_asylum %>% "
"0","#   st_as_sf(coords = c(""lon"", ""lat""),"
"0","#            crs = 4326)"
"0","# "
"0","# # Read and transform data for internally displaced persons"
"0","# df_idp <- top10_idps %>% "
"0","#   st_as_sf(coords = c(""lon"", ""lat""),"
"0","#            crs = 4326)"
"0",""
"0",""
"0",""
